name: Notify Discord on PR Review

on:
  pull_request_review:
    types: [submitted]   # ë¦¬ë·°ê°€ ì œì¶œ(submit)ë  ë•Œ íŠ¸ë¦¬ê±°

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send message to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          REVIEW_STATE: ${{ github.event.review.state }}
          REVIEW_BODY: ${{ github.event.review.body }}
          REVIEWER: ${{ github.event.review.user.login }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
        run: |
          echo "Sending PR Review notification to Discord..."

          # JSON payload ìƒì„±
          PAYLOAD=$(jq -n \
            --arg content "**ğŸ” Pull Request Review Submitted**" \
            --arg reviewer "$REVIEWER" \
            --arg state "$REVIEW_STATE" \
            --arg body "$REVIEW_BODY" \
            --arg prtitle "$PR_TITLE" \
            --arg prurl "$PR_URL" \
            '{
              "content": $content,
              "embeds": [
                {
                  "title": $prtitle,
                  "url": $prurl,
                  "color": 3447003,
                  "fields": [
                    {"name": "ğŸ‘¤ ë¦¬ë·°ì–´", "value": $reviewer, "inline": true},
                    {"name": "ğŸ“Œ ìŠ¹ì¸ ì—¬ë¶€", "value": $state, "inline": true},
                    {"name": "ğŸ’¬ ë¦¬ë·° ë‚´ìš©", "value": ($body // "No comment")}
                  ]
                }
              ]
            }'
          )

          # ë””ìŠ¤ì½”ë“œ ì „ì†¡
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "$DISCORD_WEBHOOK_URL"
