name: Notify Discord on PR Review

on:
  pull_request_review:
    types: [submitted]   # Î¶¨Î∑∞Í∞Ä Ï†úÏ∂ú(submit)Îê† Îïå Ìä∏Î¶¨Í±∞

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send message to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          REVIEW_STATE: ${{ github.event.review.state }}
          REVIEW_BODY: ${{ github.event.review.body }}
          REVIEWER: ${{ github.event.review.user.login }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
        run: |
          echo "Sending PR Review notification to Discord..."

          # JSON payload ÏÉùÏÑ±
          PAYLOAD=$(jq -n \
            --arg content "**üîç Pull Request Review Submitted**" \
            --arg reviewer "$REVIEWER" \
            --arg state "$REVIEW_STATE" \
            --arg body "$REVIEW_BODY" \
            --arg prtitle "$PR_TITLE" \
            --arg prurl "$PR_URL" \
            '{
              "content": $content,
              "embeds": [
                {
                  "title": $prtitle,
                  "url": $prurl,
                  "color": 3447003,
                  "fields": [
                    {"name": "üë§ Reviewer", "value": $reviewer, "inline": true},
                    {"name": "üìå State", "value": $state, "inline": true},
                    {"name": "üí¨ Review Comment", "value": ($body // "No comment")}
                  ]
                }
              ]
            }'
          )

          # ÎîîÏä§ÏΩîÎìú Ï†ÑÏÜ°
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "$DISCORD_WEBHOOK_URL"
